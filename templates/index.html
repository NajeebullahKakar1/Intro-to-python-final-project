<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Library System</title>
<style>
body{font-family:Arial;background:#f5f5f5;margin:0;padding:0;}
header{background:#4CAF50;color:white;text-align:center;padding:1rem;}
main{padding:2rem;max-width:900px;margin:auto;}
h2{color:#333;}
table{width:100%;border-collapse:collapse;background:white;border-radius:8px;overflow:hidden;box-shadow:0 0 10px rgba(0,0,0,0.1);margin-bottom:2rem;}
th,td{padding:0.8rem;text-align:left;border-bottom:1px solid #ddd;}
th{background:#f2f2f2;}
tr:hover{background:#f1f1f1;}
button{background:#4CAF50;color:white;padding:0.5rem 1rem;border:none;border-radius:4px;cursor:pointer;}
button:hover{background:#45a049;}
input, select{padding:0.5rem;margin:0.5rem 0;border-radius:4px;border:1px solid #ccc;width:100%;}
form{background:white;padding:1rem;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,0.1);margin-bottom:2rem;}
</style>
</head>
<body>
<header><h1>Library System</h1></header>
<main>

<h2>Available Books</h2>
<table id="booksTable">
<thead><tr><th>ID</th><th>Title</th><th>Author</th><th>Year</th><th>Language</th><th>Available</th><th>Actions</th></tr></thead>
<tbody></tbody>
</table>

<h2>Borrowed Books</h2>
<table id="borrowedTable">
<thead><tr><th>Borrow ID</th><th>Book</th><th>User</th><th>Borrow Date</th><th>Return</th></tr></thead>
<tbody></tbody>
</table>

<script>
async function loadBooks(){
  const res=await fetch("/books");
  const books=await res.json();
  const tbody=document.querySelector("#booksTable tbody");
  tbody.innerHTML="";
  books.forEach(book=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${book.id}</td><td>${book.title}</td><td>${book.author}</td><td>${book.year||""}</td><td>${book.language||""}</td><td>${book.available?"Yes":"No"}</td>
<td>${book.available?`<button onclick="borrowBook(${book.id})">Borrow</button>`:""}</td>`;
    tbody.appendChild(tr);
  });
}

async function loadBorrowed(){
  const res=await fetch("/borrowed");
  const borrowed=await res.json();
  const tbody=document.querySelector("#borrowedTable tbody");
  tbody.innerHTML="";
  borrowed.forEach(b=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${b.id}</td><td>${b.title}</td><td>${b.username}</td><td>${new Date(b.borrow_date).toLocaleString()}</td>
<td><button onclick="returnBook(${b.id})">Return</button></td>`;
    tbody.appendChild(tr);
  });
}

async function borrowBook(bookId){
  const studentName=prompt("Enter your name:");
  if(!studentName)return;
  await fetch("/borrow",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({book_id:bookId})});
  loadBooks(); loadBorrowed();
}

async function returnBook(borrowId){
  await fetch(`/return/${borrowId}`,{method:"POST"});
  loadBooks(); loadBorrowed();
}

// Initial load + auto-refresh
loadBooks(); loadBorrowed();
setInterval(()=>{loadBooks(); loadBorrowed();},5000);
</script>
</main>
</body>
</html>
